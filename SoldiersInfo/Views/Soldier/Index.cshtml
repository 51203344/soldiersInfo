@model PagedList.IPagedList<SoldiersInfo.Models.Soldier>
@using PagedList.Mvc;

@{
    if (!string.IsNullOrEmpty(ViewBag.CurrentFilter))
    {
        ViewBag.Title = "Tìm kiếm " + '"' + ViewBag.CurrentFilter + '"';
    }
    else
    {
        ViewBag.Title = "Mục lục";
    }
}

@*Modal*@
<div class="modal fade" id="print_modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">In thông tin chiến sĩ</h4>
            </div>
            @using (Html.BeginForm("Print", "Soldier", FormMethod.Post))
            {
            @Html.AntiForgeryToken()
            <div class="modal-body">
                <div class="hidden">
                    <label for="">ID</label>
                    <input type="text" id="soldier_ID" name="soldier_ID" />
                </div>
                <div class="hidden">
                    <label for="decisionNo">Đơn vị công tác</label>
                    <input type="text" id="company" name="company" />
                </div>
                <div class="hidden">

                </div>
                <fieldset class="form-group row">
                    <div class="form-group col-lg-6 col-md-6 col-sm-6 col-xs-12">
                        <label for="decisionString">Quyết định</label>
                        <div class="input-group" data-toggle="tooltip" data-placement="bottom" title="Vui lòng điền số quyết định hoặc điền toàn bộ chuỗi biểu diễn số quyết định">
                            <div class="input-group-addon">Số:</div>
                            <input type="text" class="form-control" id="decisionString" name="decisionString" autocomplete="off" placeholder="Số quyết định" />
                        </div>
                    </div>
                    <div class="form-group col-lg-6 col-md-6 col-sm-6 col-xs-12">
                        <label for="decisionDate">Ngày ra quyết định</label>
                        <input type="text" class="form-control" id="decisionDate" name="decisionDate" placeholder="Định dạng dd/MM/yyyy" />
                    </div>
                </fieldset>
                <fieldset class="form-group row">
                    <div class="form-group col-lg-4 col-md-4 col-sx-3 col-xs-12">
                        <label for="deciderName">Tên người ký</label>
                        <input type="text" class="form-control" id="deciderName" name="deciderName" data-toggle="tooltip" data-placement="bottom" title="Vui lòng điền tên người ký quyết định" />
                    </div>
                    <div class="form-group col-lg-3 col-md-3 col-sx-3 col-xs-12">
                        <label for="deciderArmyRank">Quân hàm</label>
                        <input type="text" class="form-control" id="deciderArmyRank" name="deciderArmyRank" data-toggle="tooltip" data-placement="bottom" title="Vui lòng điền quân hàm người ký quyết định" />
                    </div>
                    <div class="form-group col-lg-5 col-md-5 col-sx-6 col-xs-12">
                        <label for="deciderRight">Chức vụ</label>
                        <input type="text" class="form-control" id="deciderRight" name="deciderRight" data-toggle="tooltip" data-placement="bottom" title="Vui lòng điền chức vụ người ký quyết định" />
                    </div>
                </fieldset>
                <fieldset class="form-group row" id="receiverfield">
                    <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12" id="receiverdiv">
                        <label for="recierver">Nơi nhận</label>
                    </div>
                    <div class="form-group">
                        <input type="text" class="hidden" id="defaultreceiver" name="receiver" />
                    </div>
                </fieldset>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Hủy</button>
                <button type="submit" id="print_button" class="btn btn-success">In</button>

            </div>
            }
        </div>
    </div>
</div>

<div class="modal fade" id="import_modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Nhập thông tin chiến sĩ</h4>
            </div>
            @using (Html.BeginForm("ImportDataFromFile", "Soldier", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <label for="file">Chọn tập tin:</label>
                    <input type="file" name="file" autocomplete="off" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Hủy</button>
                    <input type="submit" id="import_button" class="btn btn-success" value="Nhập"/>
                </div>
            }
        </div>
    </div>
</div>
<h2>Danh sách chiến sĩ</h2>

@using (Html.BeginForm("Index", "Soldier", FormMethod.Get))
{
    <form>
        <div class="row">
            <div class="col-lg-6 btn-group">
                @Html.ActionLink("Tạo mới", "Create", null, new { @class = "btn btn-default" })
                <button id="importButton" type="button" class="btn btn-default" data-backdrop="static" data-target="#import_modal" data-toggle="modal">Nhập từ tệp</button>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                    <input name="searchString" type="text" class="form-control" value="@ViewBag.CurrentFilter"
                           placeholder="Nội dung tìm kiếm" />
                    <span class="input-group-addon">Tìm theo: </span>
                    <div class="input-group-btn" style="width:initial">
                        @Html.DropDownList("searchOption", (IEnumerable<SelectListItem>)ViewBag.SearchOptionList, new { @class = "form-control" })
                    </div>
                    <div class="input-group-btn">
                        <input class="btn btn-default" type="submit" value="Tìm kiếm" />
                    </div>
                </div><!-- /input-group -->
                <br style="clear:both" />
            </div><!-- /.col-lg-6 -->
        </div><!-- /.row -->
    </form>
}
@*table of records*@
<div class="container">
    @if (ViewBag.Modelsize > 0)
    {
        <table id="tableSoldiers" class="table table-striped table-hover table-condensed">
            <tr>
                @if (ViewBag.SearchOption == "company")
                {
                <th></th>}
                <th>
                    @Html.ActionLink("Họ và tên lót", "Index",
                  new { sortOrder = ViewBag.LastNameSortParm, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption })
                </th>
                <th>
                    @Html.ActionLink("Tên", "Index",
                  new { sortOrder = ViewBag.FirstNameSortParm, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption })
                </th>
                <th>
                    @Html.ActionLink("Năm sinh", "Index",
                   new { sortOrder = ViewBag.BirthdaySortParm, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption })
                </th>
                <th>
                    @Html.ActionLink("Đơn vị", "Index",
                   new { sortOrder = ViewBag.CompSortParm, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption })
                </th>
                <th>
                    @Html.ActionLink("Ngày vào CAND", "Index",
                   new { sortOrder = ViewBag.ServingDateSortParm, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption })
                </th>
                <th>
                    @Html.ActionLink("Thời điểm hưởng khởi điểm", "Index",
                   new { sortOrder = ViewBag.PointDateSortParm, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption })
                </th>
                <th>
                    @Html.DisplayName("Ghi chú")
                </th>
                <th>
                    @Html.ActionLink("Thông báo", "Index",
                   new { sortOrder = ViewBag.AnnouceSortParm, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption })
                </th>
                <th></th>
            </tr>
            @foreach (var item in Model)
            {
                <tr>
                    @if (ViewBag.SearchOption == "company")
                    {
                        <td>
                            <input type="checkbox" name="printSoldier" class="checkbox" value="@item.ID" checked />
                        </td>
                    }
                    <td>
                        @Html.DisplayFor(modelItem => item.lastName) @Html.DisplayFor(modelItem => item.middleName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.firstName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.birthday.Year)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.company)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.servingDate.Month)/@Html.DisplayFor(modelItem => item.servingDate.Year)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.pointDate.Month)/@Html.DisplayFor(modelItem => item.pointDate.Year)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.note)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.annouce)
                    </td>
                    <td>
                        <div>
                            @Html.ActionLink("Chỉnh sửa", "Edit", new { id = item.ID }, new { @role = "button", @class = "btn btn-sm btn-primary" })
                            <button id="printOne" type="button" class="btn btn-sm btn-success" data-backdrop="static" data-target="#print_modal" data-toggle="modal" data-soldierid=@item.ID data-company=@item.company data-datenow=@DateTime.Now.GetDateTimeFormats('d')[0]>In</button>
                            @Html.ActionLink("Xóa", "Delete", new { id = item.ID }, new { @role = "button", @class = "btn btn-sm btn-danger" })
                        </div>
                    </td>
                </tr>
            }
        </table>
    }
    else
    {
        <h5>
            Không có kết quả phù hợp!
        </h5>
    }
</div>
<div class="row">
    <div class="col-lg-12 btn-group">
        @if (!String.IsNullOrEmpty(ViewBag.CurrentFilter) || (String.IsNullOrEmpty(ViewBag.CurrentFilter) && (!String.IsNullOrEmpty(ViewBag.SearchOption))))
        {
            if ((ViewBag.SearchOption == "company") && (ViewBag.Modelsize > 0))
            {
                <button id="printCompany" type="button" class="btn btn-success" data-backdrop="static" data-target="#print_modal" data-toggle="modal" data-company="@ViewBag.CurrentFilter" data-datenow=@DateTime.Now.GetDateTimeFormats('d')[0]>In nhóm</button>
            }
            @Html.ActionLink("Hủy tìm kiếm", "Index", null, new { @class = "btn btn-default" })
        }

    </div>
    <br />
    @if (Model.PageCount > 1)
    {
        <p>Trang @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)  @*@Model.PageCount*@</p>

        @Html.PagedListPager(Model, page => Url.Action("Index",
    new { page, sortOrder = ViewBag.CurrentSort, currentFilter = ViewBag.CurrentFilter, searchOption = ViewBag.SearchOption }))
    }
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jquerycustom")
}

@Styles.Render("~/bundles/customcss")